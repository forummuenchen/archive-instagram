<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instagram Archive</title>
    <link rel="stylesheet" href="static/css/styles.css" />
    <style>
.sort-arrow {
  font-size: 0.9em;
  margin-left: 0.2em;
  color: #bbb;
  transition: color 0.2s;
}
th.sorted .sort-arrow {
  color: #222;
}
th {
  user-select: none;
}
    </style>
  </head>
  <body>
    <h1>Instagram Archive</h1>

    <div class="attention">
      <strong>Hinweis:</strong> Dieses Archiv enthält Posts, Highlights - und
      falls gerade zum richtigen Zeitpunkt die Daten abgefragt wurden - auch
      Storys von Instagram-Accounts. Außerdem Posts, auf denen der Account
      getagged wurde. Es kann sein, dass nicht alle Inhalte gesichert sind.
    </div>
    <h2>Posts pro Monat</h2>
    <p>Wähle eine Monat und bekomme alle Posts aller Accounts in diesem Archiv.</p>
    <label for="month-feed-select">Monatsübersicht:</label>
    <select id="month-feed-select" onchange="window.location.href=this.value;">
      <option value="">Monat wählen…</option>
      {% for key in all_months %}
        {% set y, m = key.split('/') %}
        <option value="feed/{{ y }}/{{ m }}.html">{{ m }}/{{ y }}</option>
      {% endfor %}
    </select>
    <h2>Post pro Account</h2>
    <table>
      <thead>
        <tr>
    <th data-type="string">Account <span class="sort-arrow">▲</span></th>
    <th data-type="string">Full Name <span class="sort-arrow">▲</span></th>
    <th data-type="string">Bio <span class="sort-arrow">▲</span></th>
    <th data-type="string">Einordnung <span class="sort-arrow">▲</span></th>
    <th data-type="string">Privat <span class="sort-arrow">▲</span></th>
    <th data-type="number">Posts <span class="sort-arrow">▲</span></th>
    <th data-type="number">Tagged Posts <span class="sort-arrow">▲</span></th>
    <th data-type="number">Highlights <span class="sort-arrow">▲</span></th>
        </tr>
      </thead>
      <tbody>
        {% for account in accounts %}
          {% if account.username in counts %}
            <tr>
              <td><a href="{{ account.username }}/index.html">{{ account.username }}</a></td>
              <td>{{ account.full_name }}</td>
              <td>{{ account.biography }}</td>
              <td>{{ account.br_category }}</td>
              <td>{% if account.is_private %} ✅ {% else %} ❌ {% endif %} </td>
              <td>{{ counts[account.username]['post'] | default(0) }}</td>
              <td>{{ counts[account.username]['tagged'] | default(0) }}</td>
              <td>{{ counts[account.username]['highlight'] | default(0) }}</td>
            </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
  </body>
  <script>
document.addEventListener('DOMContentLoaded', function() {
  const table = document.querySelector('table');
  const headers = table.querySelectorAll('th');
  let sortCol = 0, sortAsc = true;

  headers.forEach((th, col) => {
    th.style.cursor = 'pointer';
    th.addEventListener('click', () => {
      sortAsc = sortCol === col ? !sortAsc : true;
      sortCol = col;
      const type = th.dataset.type || "string";
      const rows = Array.from(table.tBodies[0].rows);
      rows.sort((a, b) => {
        let v1 = a.cells[col].innerText.trim();
        let v2 = b.cells[col].innerText.trim();
        if(type === "number") {
          v1 = parseInt(v1.replace(/\D/g, '')) || 0;
          v2 = parseInt(v2.replace(/\D/g, '')) || 0;
          return sortAsc ? v1 - v2 : v2 - v1;
        } else {
          return sortAsc ? v1.localeCompare(v2) : v2.localeCompare(v1);
        }
      });
      rows.forEach(row => table.tBodies[0].appendChild(row));
      headers.forEach((h, i) => {
        h.classList.toggle('sorted', i === col);
        const arrow = h.querySelector('.sort-arrow');
        if (arrow) arrow.textContent = (i === col) ? (sortAsc ? '▲' : '▼') : '▲';
      });
    });
  });

  // Initial: erste Spalte als sortiert markieren
  headers[0].classList.add('sorted');
});
</script>
</html>
